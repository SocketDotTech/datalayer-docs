"use strict";(self.webpackChunkdatalayer_docs=self.webpackChunkdatalayer_docs||[]).push([[1165],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),u=i,g=d["".concat(c,".").concat(u)]||d[u]||h[u]||o;return n?a.createElement(g,r(r({ref:t},p),{},{components:n})):a.createElement(g,r({ref:t},p))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[d]="string"==typeof e?e:i,r[1]=s;for(var l=2;l<o;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1189:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var a=n(7462),i=(n(7294),n(3905));const o={id:"lifecycle",title:"Lifecycle",sidebar_position:5},r=void 0,s={unversionedId:"Learn/lifecycle",id:"Learn/lifecycle",title:"Lifecycle",description:"In this section, we dive deeper into the main interactions between Plugs and Socket",source:"@site/docs/Learn/lifecycle.md",sourceDirName:"Learn",slug:"/Learn/lifecycle",permalink:"/Learn/lifecycle",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{id:"lifecycle",title:"Lifecycle",sidebar_position:5},sidebar:"defaultSidebar",previous:{title:"Protocol Design",permalink:"/Learn/protocol-design"},next:{title:"Components",permalink:"/category/components"}},c={},l=[{value:"Connecting to Socket",id:"connecting-to-socket",level:3},{value:"General Notes :",id:"general-notes-",level:4},{value:"Sending a message",id:"sending-a-message",level:3},{value:"Receiving a message",id:"receiving-a-message",level:3}],p={toc:l},d="wrapper";function h(e){let{components:t,...n}=e;return(0,i.kt)(d,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"In this section, we dive deeper into the main interactions between Plugs and Socket"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#connecting-to-socket"},"Connecting to Socket")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#sending-a-message"},"Sending a message")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#receiving-a-message"},"Receiving a message")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#switchboards-101"},"Switchboards 101"))),(0,i.kt)("h3",{id:"connecting-to-socket"},"Connecting to Socket"),(0,i.kt)("img",{src:"/img/ConnectToDL.png"}),(0,i.kt)("p",null,'Before Plugs can start sending and receiving messages, they need to connect or get "plugged" into Socket. Plugs connect to sibling plugs deployed on other chains by sending configuration details such as sibling chain ID, sibling plug address and switchboard configuration.'),(0,i.kt)("p",null,"Upon connection, Socket generates a unique identifier for the configuration and stores it. It then emits an event ",(0,i.kt)("inlineCode",{parentName:"p"},"PlugConnected")," with the config data. Here's an ",(0,i.kt)("a",{parentName:"p",href:"https://polygonscan.com/tx/0x58231336368ff437883ada95d30897679f64257c981ee19dab8147c0b3828d0a#eventlog"},"example transaction"),"."),(0,i.kt)("h4",{id:"general-notes-"},"General Notes :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Plugs may use different switchboards depending on their usecases and security requirements. They can even build a custom switchboard."),(0,i.kt)("li",{parentName:"ul"},"Plugs can only connect to one plug on each sibling chain. Connecting with a different sibling plug configuration for the same chain will override the previous configuration.")),(0,i.kt)("h3",{id:"sending-a-message"},"Sending a message"),(0,i.kt)("p",null,"Plugs build on top of Socket to initiate state changes on Plugs deployed on other chains. They do this by passing a message payload that has the state changes encoded, which destination plugs decode and execute."),(0,i.kt)("img",{src:"/img/SendMessageOutbound.png"}),(0,i.kt)("p",null,"To pass a message, Plugs call the ",(0,i.kt)("inlineCode",{parentName:"p"},"outbound")," method on Socket with ",(0,i.kt)("inlineCode",{parentName:"p"},"fees"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"siblingChainSlug"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"msgGasLimit"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"payload"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"transmitterParams"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"executorParams"),". Socket checks the stored configuration of the plug and verifies a connection with the sibling chain was previously instantiated. It then deducts the fee sent from the plug and pays to various off-chain actors."),(0,i.kt)("p",null,"Plugs need to pay a fee to off-chain actors to get messages included in a packet to be executed on the destination chain. More on ",(0,i.kt)("a",{parentName:"p",href:"/Learn/Concepts/fees"},"Fees here"),"."),(0,i.kt)("p",null,"Socket encodes key parameters into a message and hashes the encoded data. It then calls the capacitor and stores the hashed message in the capacitor. This emits a ",(0,i.kt)("inlineCode",{parentName:"p"},"MessageAdded")," event. The message is stored in the capacitor until it can be emitted. Capacitors are chain specific and all messages to be sent to respective destination chains get aggregated in a given capacitor."),(0,i.kt)("p",null,"Periodically, Off-chain transmitters will call ",(0,i.kt)("inlineCode",{parentName:"p"},"seal()")," method on the capacitor which seals all stored messages into a packet and emits a ",(0,i.kt)("inlineCode",{parentName:"p"},"Sealed")," event for the packet."),(0,i.kt)("p",null,"This event is then picked up by transmitters that propose this packet on the destination chain. More on this below"),(0,i.kt)("h3",{id:"receiving-a-message"},"Receiving a message"),(0,i.kt)("p",null,"Once the packet is sealed on the source chain, the transmitter proposes this sealed packet to Socket on the destination chain. This includes the ",(0,i.kt)("inlineCode",{parentName:"p"},"packetId"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"root"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"switchboard")," & ",(0,i.kt)("inlineCode",{parentName:"p"},"signature"),". Sending the ",(0,i.kt)("inlineCode",{parentName:"p"},"signature")," separately allows the transmitter to sign messages from an authorized address, but be relayed by anyone."),(0,i.kt)("p",null,"The transmitter proposes the packet for specified Switchboard and a ",(0,i.kt)("inlineCode",{parentName:"p"},"packetCount")," is assigned to this proposal. If the address proposing the packet is a valid transmitter, the packet proposal is successful. The packet is stored in a mapping ",(0,i.kt)("inlineCode",{parentName:"p"},"packetIdRoots")," and a ",(0,i.kt)("inlineCode",{parentName:"p"},"PacketProposed")," event is emitted."),(0,i.kt)("img",{src:"/img/propose-packet.png",width:"600px"}),(0,i.kt)("p",null,"Once a packet is proposed, depending on the Switchboard used, the packet's validity is verified by watchers. More on ",(0,i.kt)("a",{parentName:"p",href:"#switchboards-101"},"this here"),"."),(0,i.kt)("p",null,"Once the packet is verified, executors then call ",(0,i.kt)("inlineCode",{parentName:"p"},"execute")," on a message. During the execution of the message, the following is checked : "),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The message is included in a packet (Decapacitor)"),(0,i.kt)("li",{parentName:"ol"},"The packet has been verified by the switchboard and exists on the source chain (Switchboard)")),(0,i.kt)("img",{src:"/img/ExecuteMessage.png",width:"600px"}),(0,i.kt)("p",null,"If these are verified, then the message can be executed. ",(0,i.kt)("inlineCode",{parentName:"p"},"Executors")," call the execute() method on Socket which checks if the above cases are verified and calls the ",(0,i.kt)("inlineCode",{parentName:"p"},"inbound")," method on the destination plug. It passes the designated payload to the Plug, which can be arbitrarily executed."),(0,i.kt)("p",null,"In case the message cannot be executed due to insufficient gas limit or other errors, Socket will re-try execution periodically. More in ",(0,i.kt)("a",{parentName:"p",href:"/dev-resources/TutorialSection/retry-execute"},"Execution Failure"),"."))}h.isMDXComponent=!0}}]);